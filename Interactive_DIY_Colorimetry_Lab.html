<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIY Colorimetry Lab - Interactive Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- KaTeX for mathematical formula rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'IBM Plex Mono', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1a1a2e;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            text-align: center;
            color: #fff;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .header-badge {
            display: inline-block;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 8px 25px;
            border-radius: 25px;
            margin-bottom: 15px;
            font-size: 0.9em;
            font-weight: 600;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            letter-spacing: 2px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
            color: #a5b4fc;
        }

        /* Status Bar */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fff;
            border-radius: 10px;
            padding: 12px 25px;
            margin-bottom: 20px;
            font-size: 0.9em;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #4a5568;
        }

        .save-status {
            padding: 5px 15px;
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            border-radius: 15px;
            font-weight: 600;
            color: #1a1a2e;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            background: #fff;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .tab-btn {
            background: #f1f5f9;
            color: #475569;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: #e2e8f0;
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .tab-btn.instructor-tab {
            background: #fef3c7;
            color: #92400e;
        }

        .tab-btn.instructor-tab:hover {
            background: #fde68a;
        }

        .tab-btn.instructor-tab.active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #fff;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            background: #fff;
            border-radius: 15px;
            padding: 35px;
            min-height: 600px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        /* Section Headers */
        h2 {
            font-size: 1.5em;
            margin: 30px 0 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid;
            border-image: linear-gradient(135deg, #667eea 0%, #764ba2 100%) 1;
            color: #1e293b;
        }

        h2:first-child {
            margin-top: 0;
        }

        h3 {
            font-size: 1.2em;
            margin: 25px 0 15px;
            padding-left: 15px;
            border-left: 4px solid #667eea;
            color: #334155;
        }

        p {
            margin-bottom: 15px;
            color: #475569;
        }

        /* Info Boxes */
        .info-box {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            background: #f8fafc;
        }

        .info-box.highlight {
            border-color: #667eea;
            background: linear-gradient(135deg, #eef2ff 0%, #faf5ff 100%);
        }

        .info-box-title {
            font-weight: 700;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px dashed #cbd5e1;
            color: #667eea;
        }

        /* Lists */
        ul, ol {
            margin-left: 30px;
            margin-bottom: 15px;
        }

        li {
            margin: 10px 0;
            color: #475569;
        }

        /* Student Info Form */
        .student-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .field-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .field-group label {
            font-weight: 600;
            color: #334155;
        }

        .field-group input {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            color: #1e293b;
            padding: 12px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1em;
            transition: all 0.3s;
        }

        .field-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        th, td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: center;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            font-weight: 600;
        }

        td input {
            background: transparent;
            border: none;
            border-bottom: 2px dashed #cbd5e1;
            color: #1e293b;
            width: 90%;
            text-align: center;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.95em;
            padding: 5px;
        }

        td input:focus {
            outline: none;
            border-bottom-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        td.calculated {
            background: linear-gradient(135deg, #eef2ff 0%, #faf5ff 100%);
            font-weight: 600;
            color: #5b21b6;
        }

        /* Formula Box */
        .formula-box {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: #fbbf24;
            padding: 20px;
            text-align: center;
            font-size: 1.3em;
            margin: 20px 0;
            font-weight: 600;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .formula-box .katex {
            color: #fbbf24;
            font-size: 1.4em;
        }

        /* KaTeX styling overrides */
        .katex {
            font-size: 1.1em;
        }

        .info-box .katex, p .katex {
            color: #5b21b6;
        }

        /* Procedure Steps */
        .procedure-step {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .step-number {
            flex-shrink: 0;
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2em;
            color: #fff;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .step-content {
            flex: 1;
            color: #475569;
        }

        /* Question Box */
        .question {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            background: #fefefe;
        }

        .question-num {
            font-weight: 700;
            margin-bottom: 10px;
            color: #667eea;
        }

        .question textarea {
            width: 100%;
            min-height: 100px;
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            color: #1e293b;
            padding: 15px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.95em;
            resize: vertical;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .question textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        /* Graph Container */
        .graph-container {
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(135deg, #eef2ff 0%, #faf5ff 100%);
            border-radius: 15px;
            border: 2px solid #667eea;
        }

        .graph-container canvas {
            background: #fff;
            border-radius: 10px;
        }

        .graph-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .stat-box {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .stat-label {
            font-size: 0.85em;
            color: #64748b;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 1.4em;
            font-weight: 700;
            color: #667eea;
        }

        /* Buttons */
        .btn {
            background: #fff;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1em;
            margin: 5px;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn:hover {
            background: #667eea;
            color: #fff;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        /* Checklist */
        .checklist-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 18px;
            background: #f8fafc;
            border-radius: 10px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checklist-item:hover {
            background: #eef2ff;
            transform: translateX(5px);
        }

        .checklist-box {
            width: 26px;
            height: 26px;
            border: 2px solid #667eea;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #fff;
            transition: all 0.3s;
        }

        .checklist-item.checked .checklist-box {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
        }

        /* Materials Grid */
        .materials-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .materials-box {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e2e8f0;
        }

        .materials-box h4 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px dashed #cbd5e1;
            color: #667eea;
        }

        /* Color Gradient Display */
        .color-gradient {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .color-swatch {
            text-align: center;
            flex: 1;
        }

        .color-circle {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            margin: 0 auto 10px;
            border: 3px solid #e2e8f0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* Safety Box */
        .safety-box {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 2px solid #ef4444;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .safety-box h3 {
            border-left: none;
            padding-left: 0;
            margin-top: 0;
            color: #dc2626;
        }

        .safety-box li {
            color: #7f1d1d;
        }

        /* Tip Box */
        .tip-box {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left: 4px solid #10b981;
            border-radius: 0 12px 12px 0;
            padding: 18px 22px;
            margin: 20px 0;
            color: #065f46;
        }

        /* Conclusion Box */
        .conclusion-box {
            background: linear-gradient(135deg, #eef2ff 0%, #faf5ff 100%);
            border: 3px solid #667eea;
            border-radius: 15px;
            padding: 35px;
            margin: 30px 0;
            text-align: center;
        }

        .conclusion-box h3 {
            border-left: none;
            padding-left: 0;
            color: #5b21b6;
        }

        .final-answer {
            font-size: 1.5em;
            margin-top: 15px;
            color: #667eea;
        }

        .final-answer input {
            background: #fff;
            border: 2px solid #667eea;
            border-radius: 8px;
            color: #5b21b6;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1em;
            width: 100px;
            text-align: center;
            padding: 8px;
        }

        /* Instructor Sections */
        .instructor-only {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
        }

        .answer-key-value {
            color: #92400e;
            font-style: italic;
        }

        .instructor-note {
            background: #fff7ed;
            border: 2px dashed #f59e0b;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            color: #92400e;
        }

        /* App Link */
        .app-link {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 12px 25px;
            border-radius: 10px;
            margin: 10px 0;
            text-decoration: none;
            color: #fff;
            font-weight: 600;
            transition: all 0.3s;
        }

        .app-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        /* Print Styles */
        @media print {
            body {
                background: #fff;
            }
            .tab-nav, .status-bar, .btn-group, .instructor-tab {
                display: none !important;
            }
            .tab-content {
                display: block !important;
                box-shadow: none;
            }
            .tab-content.instructor-only {
                display: none !important;
            }
            .container {
                max-width: 100%;
            }
            .header {
                background: #1a1a2e;
                color: #fff;
            }
        }

        /* Responsive */
        @media (max-width: 900px) {
            .student-info, .materials-grid, .graph-stats {
                grid-template-columns: 1fr;
            }
            .tab-nav {
                flex-direction: column;
            }
            .tab-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <span class="header-badge">LIFE CHEMISTRY 101</span>
            <h1>DIY COLORIMETRY LAB</h1>
            <p class="subtitle">Quantitative Analysis Using Smartphone Colorimetry - Interactive Edition</p>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-indicator">
                <span>SESSION:</span>
                <span id="session-id">---</span>
            </div>
            <div class="status-indicator">
                <span class="save-status" id="save-status">[READY]</span>
            </div>
            <div class="status-indicator">
                <span id="current-time">--:--:--</span>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" data-tab="prelab">1. PRE-LAB READING</button>
            <button class="tab-btn" data-tab="materials">2. MATERIALS</button>
            <button class="tab-btn" data-tab="setup">3. BUILD COLORIMETER</button>
            <button class="tab-btn" data-tab="dilutions">4. DILUTIONS</button>
            <button class="tab-btn" data-tab="data">5. DATA COLLECTION</button>
            <button class="tab-btn" data-tab="analysis">6. ANALYSIS</button>
            <button class="tab-btn" data-tab="postlab">7. POST-LAB</button>
            <button class="tab-btn" data-tab="submit">8. SUBMIT</button>
            <button class="tab-btn instructor-tab" data-tab="instructor">INSTRUCTOR</button>
            <button class="tab-btn instructor-tab" data-tab="answerkey">ANSWER KEY</button>
        </div>

        <!-- TAB 1: PRE-LAB READING -->
        <div class="tab-content active" id="prelab">
            <h2>PRE-LAB READING: Light, Color, and Beer's Law</h2>

            <div class="student-info">
                <div class="field-group">
                    <label>Student Name:</label>
                    <input type="text" id="student-name" placeholder="Enter your name">
                </div>
                <div class="field-group">
                    <label>Lab Partner(s):</label>
                    <input type="text" id="lab-partners" placeholder="Enter partner names">
                </div>
                <div class="field-group">
                    <label>Date:</label>
                    <input type="text" id="lab-date" placeholder="MM/DD/YYYY">
                </div>
                <div class="field-group">
                    <label>Section/Instructor:</label>
                    <input type="text" id="section" placeholder="Enter section">
                </div>
            </div>

            <div class="info-box highlight">
                <div class="info-box-title">LEARNING OBJECTIVES</div>
                <ul>
                    <li>Construct a simple DIY colorimeter to measure light transmission through colored solutions</li>
                    <li>Prepare standard solutions via serial dilution (100%, 80%, 60%, 40%, 20%, 0%)</li>
                    <li>Apply Beer's Law (\(A = \varepsilon \cdot l \cdot c\)) by plotting absorbance against concentration</li>
                    <li>Calculate transmittance (\(T = I/I_0\)) and absorbance (\(A = -\log_{10} T\)) from measured data</li>
                    <li>Determine an unknown concentration from a calibration curve</li>
                    <li>Understand the relationship between color, light absorption, and concentration</li>
                </ul>
            </div>

            <h3>Introduction to Spectroscopy</h3>
            <p>Spectroscopy is the study of how matter interacts with light. When light passes through a colored solution, some wavelengths are absorbed while others pass through (are transmitted). The color we see is the light that is NOT absorbed.</p>

            <p>For example, grape juice appears purple/violet because it absorbs light in the yellow-green region of the spectrum and transmits (reflects) red and blue wavelengths, which combine to create the purple color we perceive.</p>

            <h3>Beer's Law (Beer-Lambert Law)</h3>
            <p>Beer's Law describes the relationship between the concentration of a solution and the amount of light it absorbs:</p>

            <div class="formula-box">
                $$A = \varepsilon \cdot l \cdot c$$
            </div>

            <div class="info-box">
                <div class="info-box-title">VARIABLE DEFINITIONS</div>
                <ul>
                    <li>\(A\) = Absorbance (unitless) — how much light is absorbed</li>
                    <li>\(\varepsilon\) = Molar absorptivity (L·mol⁻¹·cm⁻¹) — how strongly the substance absorbs</li>
                    <li>\(l\) = Path length (cm) — distance light travels through solution</li>
                    <li>\(c\) = Concentration (mol/L or %) — amount of absorbing species</li>
                </ul>
            </div>

            <h3>Transmittance and Absorbance</h3>
            <p>When light enters a sample, we measure what comes out the other side:</p>

            <div class="formula-box">
                $$\text{Transmittance: } T = \frac{I}{I_0} \quad | \quad \text{Absorbance: } A = -\log_{10}(T)$$
            </div>

            <div class="info-box">
                <div class="info-box-title">WHERE:</div>
                <ul>
                    <li>\(I_0\) = Initial light intensity (measured with blank/water)</li>
                    <li>\(I\) = Light intensity after passing through sample</li>
                    <li>\(T\) = Transmittance (fraction of light that passes through, 0 to 1)</li>
                    <li>\(A\) = Absorbance (typically 0 to 2 for measurable samples)</li>
                </ul>
            </div>

            <h3>Why Green Paper for Purple Juice?</h3>
            <p>Grape juice absorbs GREEN light most strongly. By using green construction paper as our background light source, we maximize the signal change as concentration increases. The app will measure the green channel intensity - as grape juice concentration increases, less green light passes through, and the green channel reading decreases.</p>

            <h3>The Carolina RGB Colorimeter App</h3>
            <p>We will use the Carolina RGB Colorimeter app to measure light intensity. This app reads the Red, Green, and Blue (RGB) values detected by your phone's camera.</p>

            <a href="https://apps.apple.com/app/carolina-rgb-colorimeter/id6445908681" target="_blank" class="app-link">
                [DOWNLOAD] Carolina RGB Colorimeter - App Store
            </a>

            <h2>PRE-LAB QUESTIONS</h2>
            <p>Complete these questions before coming to lab:</p>

            <div class="question">
                <div class="question-num">QUESTION 1:</div>
                <p>Write Beer's Law equation and define each variable:</p>
                <textarea id="prelab-q1" placeholder="Enter your answer here..."></textarea>
            </div>

            <div class="question">
                <div class="question-num">QUESTION 2:</div>
                <p>If light intensity through a blank (\(I_0\)) is 200 and through a sample (\(I\)) is 100, calculate:</p>
                <p>a) Transmittance (\(T = I/I_0\))</p>
                <p>b) Absorbance (\(A = -\log_{10} T\))</p>
                <p>Show your calculations:</p>
                <textarea id="prelab-q2" placeholder="Enter your calculations here..."></textarea>
            </div>

            <div class="question">
                <div class="question-num">QUESTION 3:</div>
                <p>Grape juice appears purple/violet. Based on the color wheel, what color light does it primarily absorb? Why are we using green construction paper as our background?</p>
                <textarea id="prelab-q3" placeholder="Enter your answer here..."></textarea>
            </div>

            <div class="question">
                <div class="question-num">QUESTION 4:</div>
                <p>Which RGB channel (Red, Green, or Blue) should show the greatest change in intensity as grape juice concentration increases? Explain your reasoning.</p>
                <textarea id="prelab-q4" placeholder="Enter your answer here..."></textarea>
            </div>

            <div class="question">
                <div class="question-num">QUESTION 5:</div>
                <p>Name TWO real-world applications where colorimetry/spectroscopy is used:</p>
                <textarea id="prelab-q5" placeholder="1.
2. "></textarea>
            </div>
        </div>

        <!-- TAB 2: MATERIALS -->
        <div class="tab-content" id="materials">
            <h2>MATERIALS AND EQUIPMENT</h2>

            <div class="materials-grid">
                <div class="materials-box">
                    <h4>PROVIDED BY LAB</h4>
                    <ul>
                        <li>[ ] Grape juice (stock solution, 100%)</li>
                        <li>[ ] Unknown grape juice sample</li>
                        <li>[ ] Distilled water</li>
                        <li>[ ] Clear plastic cuvettes or test tubes (7)</li>
                        <li>[ ] Graduated cylinders (10 mL)</li>
                        <li>[ ] Pipettes (various sizes)</li>
                        <li>[ ] Test tube rack</li>
                        <li>[ ] Green construction paper</li>
                        <li>[ ] Labels/marker</li>
                    </ul>
                </div>
                <div class="materials-box">
                    <h4>STUDENT PROVIDED / AT STATION</h4>
                    <ul>
                        <li>[ ] Smartphone with Carolina RGB Colorimeter app</li>
                        <li>[ ] Cardboard box (shoebox size)</li>
                        <li>[ ] Scissors</li>
                        <li>[ ] Tape (masking or clear)</li>
                        <li>[ ] Calculator</li>
                        <li>[ ] Book (for elevation if needed)</li>
                        <li>[ ] Ruler (optional)</li>
                    </ul>
                </div>
            </div>

            <div class="safety-box">
                <h3>[!] SAFETY PRECAUTIONS</h3>
                <ul>
                    <li><strong>Grape juice stains fabric permanently!</strong> Wear a lab coat or old clothes; clean spills immediately</li>
                    <li><strong>No eating or drinking</strong> - lab solutions are not for consumption</li>
                    <li><strong>Handle glassware carefully</strong> - report any broken glass to your instructor</li>
                    <li><strong>Keep electronics dry</strong> - water damage to phones is your responsibility</li>
                    <li><strong>Scissors safety</strong> - always cut away from your body when constructing the box</li>
                    <li><strong>Clean your workspace</strong> thoroughly at the end of the experiment</li>
                </ul>
            </div>

            <h3>Required App</h3>
            <div class="info-box">
                <div class="info-box-title">CAROLINA RGB COLORIMETER</div>
                <p>Download the Carolina RGB Colorimeter app before coming to lab:</p>
                <a href="https://apps.apple.com/app/carolina-rgb-colorimeter/id6445908681" target="_blank" class="app-link">
                    [DOWNLOAD] Carolina RGB Colorimeter - App Store
                </a>
                <p style="margin-top: 15px;">This app displays real-time RGB values from your phone's camera, allowing us to measure light intensity passing through our samples.</p>
            </div>
        </div>

        <!-- TAB 3: BUILD COLORIMETER -->
        <div class="tab-content" id="setup">
            <h2>BUILDING YOUR DIY COLORIMETER BOX</h2>

            <p>Follow these steps to construct your colorimeter. Consistency in construction is essential for accurate measurements.</p>

            <div class="procedure-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <strong>Select your box:</strong> Choose a cardboard box that can fit your cuvette or test tube standing upright inside. The box should be approximately 15-20 cm long.
                </div>
            </div>

            <div class="procedure-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <strong>Cut the front viewing hole:</strong> On the front panel (where your phone camera will be positioned), cut a rectangular opening approximately 5-8 cm wide and 5-8 cm tall, centered on the panel. This is where your phone camera will "see" through to the sample.
                </div>
            </div>

            <div class="procedure-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <strong>Remove the back panel:</strong> Cut out the ENTIRE back panel of the box. This allows ambient room light to illuminate the colored construction paper that will serve as your light source background.
                </div>
            </div>

            <div class="procedure-step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <strong>Position the construction paper:</strong> Tape a sheet of <strong>GREEN construction paper</strong> flat behind the open back of the box. The paper should be fully visible through the front viewing hole when you look through the sample position. Keep it flat and wrinkle-free.
                </div>
            </div>

            <div class="procedure-step">
                <div class="step-number">5</div>
                <div class="step-content">
                    <strong>Secure and stabilize:</strong> Place the box on a stable surface (use a book for elevation if needed so the viewing hole is at phone-camera height). Tape the box down securely - nothing should move between measurements!
                </div>
            </div>

            <div class="procedure-step">
                <div class="step-number">6</div>
                <div class="step-content">
                    <strong>Check your lighting:</strong> Use steady room light (dim overhead lights if too bright). <strong>Avoid direct sunlight</strong> as it causes fluctuating readings. The light path is: room light -> reflects off green paper -> passes through sample -> exits front hole -> enters phone camera.
                </div>
            </div>

            <div class="procedure-step">
                <div class="step-number">7</div>
                <div class="step-content">
                    <strong>Test your RGB app:</strong> Open the Carolina RGB Colorimeter app and place your phone camera flush against the front viewing hole. If the app allows, <strong>lock the exposure and focus</strong> (tap-and-hold usually works). Place a blank (water) in the sample position - the green paper should appear bright in the green channel.
                </div>
            </div>

            <div class="tip-box">
                <strong>[TIP]</strong> Consistency is everything! Mark the exact position where you place the cuvette/tube. Every sample must go in the SAME spot with the SAME orientation.
            </div>

            <h3>Light Path Diagram</h3>
            <div class="info-box">
                <pre style="font-size: 0.9em; line-height: 1.4;">
    ROOM LIGHT
        |
        v
+------------------+
|                  |  GREEN CONSTRUCTION
|   [OPEN BACK]  <---- PAPER (light source)
|                  |
|    [CUVETTE]     |  Sample position
|       |          |  (mark this spot!)
|       v          |
|   [FRONT HOLE] ------> PHONE CAMERA
|                  |      (Carolina RGB app)
+------------------+

Light reflects off green paper, passes through
sample, exits front hole to phone camera.
                </pre>
            </div>

            <div class="question">
                <div class="question-num">COLORIMETER DIAGRAM:</div>
                <p>In the space below, describe your colorimeter setup and any modifications you made:</p>
                <textarea id="colorimeter-notes" placeholder="Describe your colorimeter setup, dimensions, and any notes about your construction..."></textarea>
            </div>
        </div>

        <!-- TAB 4: DILUTIONS -->
        <div class="tab-content" id="dilutions">
            <h2>PREPARING STANDARD SOLUTIONS (Serial Dilutions)</h2>

            <p>You will prepare 6 standard solutions by diluting the grape juice stock (100%) with distilled water. Each solution should have a <strong>total volume of 10 mL</strong>.</p>

            <table>
                <thead>
                    <tr>
                        <th>Standard</th>
                        <th>Concentration (%)</th>
                        <th>Grape Juice (mL)</th>
                        <th>Distilled Water (mL)</th>
                        <th>Total Volume (mL)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Blank</td>
                        <td>0%</td>
                        <td>0</td>
                        <td>10</td>
                        <td>10</td>
                    </tr>
                    <tr>
                        <td>Std 1</td>
                        <td>20%</td>
                        <td>2</td>
                        <td>8</td>
                        <td>10</td>
                    </tr>
                    <tr>
                        <td>Std 2</td>
                        <td>40%</td>
                        <td>4</td>
                        <td>6</td>
                        <td>10</td>
                    </tr>
                    <tr>
                        <td>Std 3</td>
                        <td>60%</td>
                        <td>6</td>
                        <td>4</td>
                        <td>10</td>
                    </tr>
                    <tr>
                        <td>Std 4</td>
                        <td>80%</td>
                        <td>8</td>
                        <td>2</td>
                        <td>10</td>
                    </tr>
                    <tr>
                        <td>Std 5</td>
                        <td>100%</td>
                        <td>10</td>
                        <td>0</td>
                        <td>10</td>
                    </tr>
                </tbody>
            </table>

            <h3>Expected Color Gradient</h3>
            <div class="color-gradient">
                <div class="color-swatch">
                    <div class="color-circle" style="background: transparent; border: 3px dashed #94a3b8;"></div>
                    <span>0%</span>
                </div>
                <div class="color-swatch">
                    <div class="color-circle" style="background: #e9d5ff; border-color: #c4b5fd;"></div>
                    <span>20%</span>
                </div>
                <div class="color-swatch">
                    <div class="color-circle" style="background: #d8b4fe; border-color: #a78bfa;"></div>
                    <span>40%</span>
                </div>
                <div class="color-swatch">
                    <div class="color-circle" style="background: #c084fc; border-color: #8b5cf6;"></div>
                    <span>60%</span>
                </div>
                <div class="color-swatch">
                    <div class="color-circle" style="background: #a855f7; border-color: #7c3aed;"></div>
                    <span>80%</span>
                </div>
                <div class="color-swatch">
                    <div class="color-circle" style="background: #7c3aed; border-color: #5b21b6;"></div>
                    <span>100%</span>
                </div>
            </div>

            <h3>Dilution Verification</h3>
            <div class="info-box">
                <div class="info-box-title">DILUTION FORMULA: \(C_1V_1 = C_2V_2\)</div>
                <p>Verify Standard 2 (40% grape juice):</p>
                <div style="margin: 15px 0;">
                    <p>\(C_1\) (stock concentration) = <input type="text" id="dilution-c1" style="width: 80px; background: #f8fafc; border: 2px solid #667eea; color: #1e293b; padding: 8px; text-align: center; border-radius: 6px;"> %</p>
                    <p>\(V_1\) (volume of stock) = <input type="text" id="dilution-v1" style="width: 80px; background: #f8fafc; border: 2px solid #667eea; color: #1e293b; padding: 8px; text-align: center; border-radius: 6px;"> mL</p>
                    <p>\(C_2\) (desired concentration) = <input type="text" id="dilution-c2" style="width: 80px; background: #f8fafc; border: 2px solid #667eea; color: #1e293b; padding: 8px; text-align: center; border-radius: 6px;"> %</p>
                    <p>\(V_2\) (total final volume) = <input type="text" id="dilution-v2" style="width: 80px; background: #f8fafc; border: 2px solid #667eea; color: #1e293b; padding: 8px; text-align: center; border-radius: 6px;"> mL</p>
                </div>
            </div>
        </div>

        <!-- TAB 5: DATA COLLECTION -->
        <div class="tab-content" id="data">
            <h2>DATA COLLECTION</h2>

            <div class="procedure-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <strong>Select your measurement channel:</strong> Test with your blank (water) and concentrated standard (100%). The GREEN channel should show the largest drop in intensity from blank to concentrated when using grape juice with green paper.
                </div>
            </div>

            <div class="procedure-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <strong>Measure the blank (\(I_0\)):</strong> Place your blank solution (0% grape juice = water) in the colorimeter box. Record the GREEN channel intensity. This is your \(I_0\) value.
                </div>
            </div>

            <div class="procedure-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <strong>Measure from LOW to HIGH:</strong> Starting with 20%, measure each standard. Take 2 readings per sample and record the average intensity (\(I\)).
                </div>
            </div>

            <div class="formula-box">
                $$T = \frac{I}{I_0} \quad | \quad A = -\log_{10}(T)$$
            </div>

            <div class="info-box highlight">
                <div class="info-box-title">BLANK (\(I_0\)) INTENSITY</div>
                <p>Channel: GREEN</p>
                <p style="margin-top: 10px;">
                    \(I_0\) = <input type="number" id="blank-intensity" style="width: 130px; background: #fff; border: 2px solid #667eea; color: #5b21b6; padding: 12px; font-size: 1.2em; text-align: center; border-radius: 8px; font-weight: 600;" placeholder="Enter I₀">
                </p>
            </div>

            <h3>Data Table</h3>
            <p>Enter your intensity readings. Transmittance (T) and Absorbance (A) will calculate automatically.</p>

            <table id="data-table">
                <thead>
                    <tr>
                        <th>Sample</th>
                        <th>Conc. (%)</th>
                        <th>\(I\) (Reading 1)</th>
                        <th>\(I\) (Reading 2)</th>
                        <th>\(I\) (Average)</th>
                        <th>\(T = I/I_0\)</th>
                        <th>\(A = -\log(T)\)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Blank</td>
                        <td>0</td>
                        <td colspan="3" class="calculated">\(I_0\) (entered above)</td>
                        <td class="calculated">1.000</td>
                        <td class="calculated">0.000</td>
                    </tr>
                    <tr>
                        <td>Std 1</td>
                        <td>20</td>
                        <td><input type="number" class="reading1" data-conc="20"></td>
                        <td><input type="number" class="reading2" data-conc="20"></td>
                        <td class="avg-cell calculated" data-conc="20">--</td>
                        <td class="t-cell calculated" data-conc="20">--</td>
                        <td class="a-cell calculated" data-conc="20">--</td>
                    </tr>
                    <tr>
                        <td>Std 2</td>
                        <td>40</td>
                        <td><input type="number" class="reading1" data-conc="40"></td>
                        <td><input type="number" class="reading2" data-conc="40"></td>
                        <td class="avg-cell calculated" data-conc="40">--</td>
                        <td class="t-cell calculated" data-conc="40">--</td>
                        <td class="a-cell calculated" data-conc="40">--</td>
                    </tr>
                    <tr>
                        <td>Std 3</td>
                        <td>60</td>
                        <td><input type="number" class="reading1" data-conc="60"></td>
                        <td><input type="number" class="reading2" data-conc="60"></td>
                        <td class="avg-cell calculated" data-conc="60">--</td>
                        <td class="t-cell calculated" data-conc="60">--</td>
                        <td class="a-cell calculated" data-conc="60">--</td>
                    </tr>
                    <tr>
                        <td>Std 4</td>
                        <td>80</td>
                        <td><input type="number" class="reading1" data-conc="80"></td>
                        <td><input type="number" class="reading2" data-conc="80"></td>
                        <td class="avg-cell calculated" data-conc="80">--</td>
                        <td class="t-cell calculated" data-conc="80">--</td>
                        <td class="a-cell calculated" data-conc="80">--</td>
                    </tr>
                    <tr>
                        <td>Std 5</td>
                        <td>100</td>
                        <td><input type="number" class="reading1" data-conc="100"></td>
                        <td><input type="number" class="reading2" data-conc="100"></td>
                        <td class="avg-cell calculated" data-conc="100">--</td>
                        <td class="t-cell calculated" data-conc="100">--</td>
                        <td class="a-cell calculated" data-conc="100">--</td>
                    </tr>
                    <tr style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);">
                        <td><strong>Unknown</strong></td>
                        <td><strong>?</strong></td>
                        <td><input type="number" class="reading1" data-conc="unknown"></td>
                        <td><input type="number" class="reading2" data-conc="unknown"></td>
                        <td class="avg-cell calculated" data-conc="unknown">--</td>
                        <td class="t-cell calculated" data-conc="unknown">--</td>
                        <td class="a-cell calculated" data-conc="unknown">--</td>
                    </tr>
                </tbody>
            </table>

            <div class="tip-box">
                <strong>[!] CRITICAL:</strong> Do NOT change the lighting, box position, or camera settings between measurements. Consistency is essential for accurate results!
            </div>

            <h3>Sample Calculation for Standard 3 (60%)</h3>
            <div class="question">
                <div class="question-num">SHOW YOUR WORK:</div>
                <p>Calculate \(T\) and \(A\) for Standard 3 using your recorded values:</p>
                <textarea id="sample-calc" placeholder="Given: I₀ = _____ , I = _____

Transmittance: T = I / I₀ = _____ / _____ = _____

Absorbance: A = -log₁₀(T) = -log₁₀(_____) = _____"></textarea>
            </div>
        </div>

        <!-- TAB 6: ANALYSIS -->
        <div class="tab-content" id="analysis">
            <h2>CALIBRATION CURVE AND ANALYSIS</h2>

            <p>Your calibration curve plots Absorbance (A) vs. Concentration (%). The graph updates in real-time as you enter data.</p>

            <div class="graph-container">
                <canvas id="calibration-chart" height="400"></canvas>
                <div class="graph-stats">
                    <div class="stat-box">
                        <div class="stat-label">SLOPE (\(m\))</div>
                        <div class="stat-value" id="slope-value">--</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Y-INTERCEPT (\(b\))</div>
                        <div class="stat-value" id="intercept-value">--</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">\(R^2\)</div>
                        <div class="stat-value" id="r2-value">--</div>
                    </div>
                </div>
            </div>

            <div class="info-box">
                <div class="info-box-title">LINE EQUATION</div>
                <p style="font-size: 1.3em; text-align: center; margin: 15px 0;">
                    \(A =\) <span id="eq-slope">m</span> \(\cdot C +\) <span id="eq-intercept">b</span>
                </p>
            </div>

            <h3>Determining Unknown Concentration</h3>

            <div class="info-box highlight">
                <div class="info-box-title">METHOD 1: GRAPHICAL</div>
                <ol>
                    <li>Locate the absorbance of your unknown on the y-axis</li>
                    <li>Draw a horizontal line to intersect the calibration curve</li>
                    <li>From intersection, draw vertical line to x-axis</li>
                    <li>Read the concentration value</li>
                </ol>
            </div>

            <div class="info-box highlight">
                <div class="info-box-title">METHOD 2: MATHEMATICAL</div>
                <p>Using the equation \(A = m \cdot C + b\), solve for \(C\):</p>
                <div class="formula-box">
                    $$C = \frac{A - b}{m}$$
                </div>
                <p>Your unknown absorbance: <span id="unknown-a-display">--</span></p>
                <p style="margin-top: 10px;"><strong>Calculated unknown concentration:</strong></p>
            </div>

            <div class="conclusion-box">
                <h3>FINAL RESULT</h3>
                <p>Unknown Grape Juice Concentration:</p>
                <div class="final-answer">
                    <span id="calculated-unknown">--</span> %
                </div>
                <p style="margin-top: 15px; font-size: 0.9em;">Enter your final answer below:</p>
                <div class="final-answer">
                    <input type="number" id="final-unknown" placeholder="--"> %
                </div>
            </div>
        </div>

        <!-- TAB 7: POST-LAB -->
        <div class="tab-content" id="postlab">
            <h2>POST-LAB QUESTIONS</h2>

            <div class="question">
                <div class="question-num">QUESTION 1:</div>
                <p>Discuss TWO potential sources of error in this experiment (besides auto-exposure on your phone camera). For each error, explain how it could impact your calibration curve's linearity or accuracy.</p>
                <p><strong>Error 1:</strong></p>
                <textarea id="postlab-q1a" placeholder="Describe the first source of error and its impact..."></textarea>
                <p><strong>Error 2:</strong></p>
                <textarea id="postlab-q1b" placeholder="Describe the second source of error and its impact..."></textarea>
            </div>

            <div class="question">
                <div class="question-num">QUESTION 2:</div>
                <p><strong>Clinical Application:</strong> In a hospital, Beer's Law is used in pulse oximetry to measure blood oxygen saturation. If a patient has jaundice (high bilirubin, which absorbs blue light), how might this interfere with the oximeter's red/infrared readings? What could clinicians do to address this interference?</p>
                <textarea id="postlab-q2" placeholder="Enter your answer here..."></textarea>
            </div>

            <div class="question">
                <div class="question-num">QUESTION 3:</div>
                <p>Your calibration curve should ideally pass through the origin (0,0). Did yours? If it had a y-intercept significantly different from zero, what might have caused this?</p>
                <textarea id="postlab-q3" placeholder="Enter your answer here..."></textarea>
            </div>

            <div class="question">
                <div class="question-num">QUESTION 4:</div>
                <p>Beer's Law states that absorbance is directly proportional to concentration. What would you expect to happen to this linear relationship if you tested very high concentrations (beyond 100% of what we used)? Explain why Beer's Law might "fail" at high concentrations.</p>
                <textarea id="postlab-q4" placeholder="Enter your answer here..."></textarea>
            </div>

            <div class="question">
                <div class="question-num">QUESTION 5:</div>
                <p>If you wanted to measure the concentration of a YELLOW solution instead of grape juice:</p>
                <p>a) What color construction paper would you use? <input type="text" id="postlab-q5a" style="width: 160px; background: #f8fafc; border: 2px solid #667eea; color: #1e293b; padding: 8px; border-radius: 6px;"></p>
                <p>b) Which RGB channel would you measure? <input type="text" id="postlab-q5b" style="width: 160px; background: #f8fafc; border: 2px solid #667eea; color: #1e293b; padding: 8px; border-radius: 6px;"></p>
                <p>c) Explain your reasoning:</p>
                <textarea id="postlab-q5c" placeholder="Enter your explanation here..."></textarea>
            </div>

            <div class="question">
                <div class="question-num">QUESTION 6:</div>
                <p>A classmate got a negative absorbance value for one of their samples. What likely went wrong, and how should they troubleshoot this issue?</p>
                <textarea id="postlab-q6" placeholder="Enter your answer here..."></textarea>
            </div>

            <h2>LAB COMPLETION CHECKLIST</h2>
            <div id="checklist">
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <span class="checklist-box"></span>
                    <span>Pre-lab questions completed before lab</span>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <span class="checklist-box"></span>
                    <span>DIY colorimeter box constructed and tested</span>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <span class="checklist-box"></span>
                    <span>Box diagram/notes recorded</span>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <span class="checklist-box"></span>
                    <span>All 6 standard dilutions prepared correctly</span>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <span class="checklist-box"></span>
                    <span>Dilution verification calculation completed</span>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <span class="checklist-box"></span>
                    <span>Data table completely filled</span>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <span class="checklist-box"></span>
                    <span>Sample calculation shown</span>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <span class="checklist-box"></span>
                    <span>Calibration curve generated</span>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <span class="checklist-box"></span>
                    <span>Unknown concentration determined</span>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <span class="checklist-box"></span>
                    <span>All post-lab questions answered</span>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <span class="checklist-box"></span>
                    <span>Workspace cleaned</span>
                </div>
            </div>
        </div>

        <!-- TAB 8: SUBMIT -->
        <div class="tab-content" id="submit">
            <h2>SUBMIT YOUR LAB</h2>

            <div class="info-box highlight">
                <div class="info-box-title">SUBMISSION INSTRUCTIONS</div>
                <ol>
                    <li>Review all sections to ensure completeness</li>
                    <li>Click "Download PDF" to save your completed lab</li>
                    <li>Upload the PDF to Canvas</li>
                </ol>
            </div>

            <div class="btn-group" style="justify-content: center; margin: 40px 0;">
                <button class="btn btn-primary" onclick="downloadPDF()">
                    [DOWNLOAD PDF]
                </button>
                <button class="btn" onclick="printLab()">
                    [PRINT LAB]
                </button>
                <button class="btn" onclick="clearAllData()">
                    [CLEAR ALL DATA]
                </button>
            </div>

            <div class="info-box">
                <div class="info-box-title">LAB SUMMARY</div>
                <p><strong>Student:</strong> <span id="summary-name">--</span></p>
                <p><strong>Date:</strong> <span id="summary-date">--</span></p>
                <p><strong>Section:</strong> <span id="summary-section">--</span></p>
                <p><strong>\(I_0\) (Blank):</strong> <span id="summary-i0">--</span></p>
                <p><strong>\(R^2\):</strong> <span id="summary-r2">--</span></p>
                <p><strong>Unknown Concentration:</strong> <span id="summary-unknown">--</span> %</p>
            </div>

            <div class="tip-box">
                <strong>[NOTE]</strong> Your data is automatically saved to your browser's local storage. You can close this page and return later to continue working.
            </div>
        </div>

        <!-- TAB 9: INSTRUCTOR MATERIALS -->
        <div class="tab-content instructor-only" id="instructor">
            <h2>INSTRUCTOR TEACHING MATERIALS</h2>

            <div class="instructor-note">
                This section is for instructor use only. Do not distribute to students.
            </div>

            <h3>Pre-Lab Discussion Points</h3>
            <div class="info-box">
                <ul>
                    <li><strong>Beer's Law foundations:</strong> Review the relationship between absorbance, concentration, and path length. Emphasize that \(A = \varepsilon \cdot l \cdot c\) only holds under certain conditions (dilute solutions, monochromatic light, no chemical reactions).</li>
                    <li><strong>Color theory:</strong> Discuss complementary colors. Purple absorbs green/yellow; using green paper maximizes the signal.</li>
                    <li><strong>Smartphone colorimetry:</strong> The Carolina RGB app reads RGB values from the camera sensor. Each channel (R, G, B) represents intensity of that color component (0-255 scale).</li>
                    <li><strong>Error sources:</strong> Auto-exposure, ambient light changes, inconsistent sample positioning, fingerprints on cuvettes, bubbles in solutions.</li>
                </ul>
            </div>

            <h3>Common Student Mistakes</h3>
            <div class="info-box">
                <ol>
                    <li><strong>Forgetting to lock exposure:</strong> Auto-exposure adjusts between measurements, ruining the calibration. Have students test with blank before and after to verify consistency.</li>
                    <li><strong>Inconsistent sample positioning:</strong> Emphasize marking the exact cuvette position and orientation.</li>
                    <li><strong>Not measuring blank first:</strong> \(I_0\) must be measured before any samples.</li>
                    <li><strong>Mixing up transmittance and absorbance:</strong> \(T = I/I_0\) (fraction), \(A = -\log(T)\). Absorbance increases with concentration; transmittance decreases.</li>
                    <li><strong>Calculation errors:</strong> Check that students are using \(\log_{10}\), not natural log (\(\ln\)).</li>
                    <li><strong>Negative absorbance values:</strong> Indicates \(I > I_0\), usually due to light changes or measurement error.</li>
                </ol>
            </div>

            <h3>Timing Guidelines</h3>
            <div class="info-box">
                <ul>
                    <li>Pre-lab review and safety: 10-15 min</li>
                    <li>Box construction: 15-20 min</li>
                    <li>Dilution preparation: 15-20 min</li>
                    <li>Data collection: 20-30 min</li>
                    <li>Calculations and graphing: 15-20 min</li>
                    <li>Post-lab questions: 15-20 min</li>
                    <li><strong>Total: approximately 2 hours</strong></li>
                </ul>
            </div>

            <h3>Unknown Sample Preparation</h3>
            <div class="info-box">
                <div class="info-box-title">RECOMMENDED UNKNOWN CONCENTRATIONS</div>
                <p>Prepare unknowns at concentrations that fall within the calibration range but are NOT identical to any standard:</p>
                <ul>
                    <li>Unknown A: 35% grape juice</li>
                    <li>Unknown B: 55% grape juice</li>
                    <li>Unknown C: 75% grape juice</li>
                    <li>Unknown D: 25% grape juice</li>
                </ul>
                <p style="margin-top: 15px;"><strong>Preparation for 50 mL of 35% unknown:</strong></p>
                <p>17.5 mL grape juice + 32.5 mL water = 50 mL at 35%</p>
            </div>

            <h3>Assessment Rubric</h3>
            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Points</th>
                        <th>Criteria</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Pre-lab Questions</td>
                        <td>15</td>
                        <td>Complete and correct answers showing understanding</td>
                    </tr>
                    <tr>
                        <td>Data Collection</td>
                        <td>25</td>
                        <td>Complete data table, reasonable values, proper calculations</td>
                    </tr>
                    <tr>
                        <td>Calibration Curve</td>
                        <td>20</td>
                        <td>Correct axes, linear trend, \(R^2 > 0.95\)</td>
                    </tr>
                    <tr>
                        <td>Unknown Determination</td>
                        <td>15</td>
                        <td>Correct method, within +/- 10% of actual value</td>
                    </tr>
                    <tr>
                        <td>Post-lab Questions</td>
                        <td>20</td>
                        <td>Thoughtful, complete answers demonstrating understanding</td>
                    </tr>
                    <tr>
                        <td>Lab Technique</td>
                        <td>5</td>
                        <td>Safety, cleanliness, proper procedure</td>
                    </tr>
                    <tr>
                        <td><strong>Total</strong></td>
                        <td><strong>100</strong></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>

            <h3>Extension Activities</h3>
            <div class="info-box">
                <ol>
                    <li><strong>Different colored solutions:</strong> Test food coloring solutions with appropriate background paper (red food coloring with cyan/blue paper, measuring red channel).</li>
                    <li><strong>Wavelength dependence:</strong> Use different colored papers to show how absorbance changes with wavelength.</li>
                    <li><strong>Real-world applications:</strong> Discuss pulse oximetry, water quality testing, clinical chemistry analyzers.</li>
                    <li><strong>Beer's Law deviations:</strong> Prepare solutions beyond 100% (if possible with concentrated stock) to demonstrate non-linearity at high concentrations.</li>
                </ol>
            </div>
        </div>

        <!-- TAB 10: ANSWER KEY -->
        <div class="tab-content instructor-only" id="answerkey">
            <h2>INSTRUCTOR ANSWER KEY</h2>

            <div class="instructor-note">
                CONFIDENTIAL - For instructor use only. Contains hypothetical realistic data and expected answers.
            </div>

            <h3>Hypothetical Data Set</h3>
            <div class="info-box">
                <div class="info-box-title">SAMPLE DATA (Using \(I_0 = 185\))</div>
                <table>
                    <thead>
                        <tr>
                            <th>Sample</th>
                            <th>Conc. (%)</th>
                            <th>\(I\) (Avg)</th>
                            <th>\(T\)</th>
                            <th>\(A\)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Blank</td>
                            <td>0</td>
                            <td>185</td>
                            <td>1.000</td>
                            <td>0.000</td>
                        </tr>
                        <tr>
                            <td>Std 1</td>
                            <td>20</td>
                            <td>152</td>
                            <td>0.822</td>
                            <td>0.085</td>
                        </tr>
                        <tr>
                            <td>Std 2</td>
                            <td>40</td>
                            <td>124</td>
                            <td>0.670</td>
                            <td>0.174</td>
                        </tr>
                        <tr>
                            <td>Std 3</td>
                            <td>60</td>
                            <td>98</td>
                            <td>0.530</td>
                            <td>0.276</td>
                        </tr>
                        <tr>
                            <td>Std 4</td>
                            <td>80</td>
                            <td>76</td>
                            <td>0.411</td>
                            <td>0.386</td>
                        </tr>
                        <tr>
                            <td>Std 5</td>
                            <td>100</td>
                            <td>58</td>
                            <td>0.314</td>
                            <td>0.503</td>
                        </tr>
                        <tr style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);">
                            <td>Unknown</td>
                            <td>~55%</td>
                            <td>105</td>
                            <td>0.568</td>
                            <td>0.246</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="info-box highlight">
                <div class="info-box-title">CALIBRATION CURVE STATISTICS</div>
                <p><strong>Slope (\(m\)):</strong> 0.00497 A/% (approximately 0.005)</p>
                <p><strong>Y-intercept (\(b\)):</strong> 0.0032 (approximately 0)</p>
                <p><strong>Equation:</strong> \(A = 0.00497 \cdot C + 0.0032\)</p>
                <p><strong>R-squared (\(R^2\)):</strong> 0.998</p>
            </div>

            <div class="info-box">
                <div class="info-box-title">UNKNOWN CALCULATION</div>
                <p>Given: \(A_{\text{unknown}} = 0.246\)</p>
                <p>Using: \(C = \frac{A - b}{m}\)</p>
                <p>\(C = \frac{0.246 - 0.0032}{0.00497}\)</p>
                <p>\(C = \frac{0.2428}{0.00497}\)</p>
                <p><strong>\(C = 48.9\%\) (approximately 49%)</strong></p>
                <p style="margin-top: 10px;">If actual unknown was 55%: percent error = \(\frac{|49-55|}{55} \times 100 = 10.9\%\)</p>
            </div>

            <h3>Pre-Lab Question Answers</h3>

            <div class="info-box">
                <div class="info-box-title">Q1: Beer's Law</div>
                <p class="answer-key-value">\(A = \varepsilon \cdot l \cdot c\)</p>
                <p class="answer-key-value">\(A\) = absorbance (unitless)</p>
                <p class="answer-key-value">\(\varepsilon\) = molar absorptivity (L·mol⁻¹·cm⁻¹)</p>
                <p class="answer-key-value">\(l\) = path length (cm)</p>
                <p class="answer-key-value">\(c\) = concentration (mol/L or %)</p>
            </div>

            <div class="info-box">
                <div class="info-box-title">Q2: Calculation</div>
                <p class="answer-key-value">a) \(T = I/I_0 = 100/200 = 0.50\)</p>
                <p class="answer-key-value">b) \(A = -\log_{10}(0.50) = -(-0.301) = 0.301\)</p>
            </div>

            <div class="info-box">
                <div class="info-box-title">Q3: Color Absorption</div>
                <p class="answer-key-value">Grape juice absorbs primarily GREEN/YELLOW light (complementary to purple/violet). We use green construction paper because it provides green light that will be absorbed by the grape juice. The more concentrated the grape juice, the more green light is absorbed, giving us a measurable signal change.</p>
            </div>

            <div class="info-box">
                <div class="info-box-title">Q4: RGB Channel</div>
                <p class="answer-key-value">The GREEN channel should show the greatest change. Since grape juice absorbs green light, as concentration increases, less green light passes through. The green channel reading will decrease from high (blank) to low (100% grape juice).</p>
            </div>

            <div class="info-box">
                <div class="info-box-title">Q5: Real-World Applications</div>
                <p class="answer-key-value">Accept any two valid applications:</p>
                <ul class="answer-key-value">
                    <li>Pulse oximetry (blood oxygen monitoring)</li>
                    <li>Clinical chemistry (blood/urine analysis)</li>
                    <li>Water quality testing</li>
                    <li>Food quality control</li>
                    <li>Drug analysis</li>
                    <li>Environmental monitoring</li>
                    <li>DNA/protein quantification</li>
                </ul>
            </div>

            <h3>Post-Lab Question Answers</h3>

            <div class="info-box">
                <div class="info-box-title">Q1: Error Sources</div>
                <p class="answer-key-value">Accept any two valid errors with explanations:</p>
                <ul class="answer-key-value">
                    <li><strong>Ambient light fluctuations:</strong> Changes in room light during measurements would cause inconsistent readings, leading to scatter in the data and poor R-squared.</li>
                    <li><strong>Fingerprints or bubbles:</strong> Contaminants on cuvettes scatter light, causing artificially low transmittance readings and higher apparent absorbance.</li>
                    <li><strong>Inconsistent sample volume:</strong> Different fill levels change the path length, affecting absorbance values non-uniformly.</li>
                    <li><strong>Temperature changes:</strong> Solution properties can change with temperature, affecting absorbance.</li>
                    <li><strong>Inaccurate dilutions:</strong> Errors in volumetric measurements affect the actual concentrations, causing deviation from expected linear relationship.</li>
                </ul>
            </div>

            <div class="info-box">
                <div class="info-box-title">Q2: Clinical Application</div>
                <p class="answer-key-value">Jaundice (bilirubin) absorbs blue light, which could interfere with the pulse oximeter's measurements. The additional light absorption might be misinterpreted as deoxygenated hemoglobin, potentially causing falsely low SpO2 readings. Clinicians can: (1) use co-oximetry which measures at more wavelengths, (2) draw arterial blood gas for direct measurement, (3) apply correction factors if bilirubin levels are known, or (4) use newer devices with additional wavelengths designed to account for interfering substances.</p>
            </div>

            <div class="info-box">
                <div class="info-box-title">Q3: Y-Intercept</div>
                <p class="answer-key-value">Ideally the curve passes through origin (0,0) because zero concentration should give zero absorbance. A non-zero y-intercept could be caused by: (1) stray light in the colorimeter, (2) blank solution contamination, (3) light leaks in the box, (4) reflection/scattering from cuvette walls, or (5) systematic measurement error in all readings.</p>
            </div>

            <div class="info-box">
                <div class="info-box-title">Q4: Beer's Law Deviations</div>
                <p class="answer-key-value">At very high concentrations, Beer's Law deviates from linearity and the calibration curve would level off (plateau). This occurs because: (1) molecules interact with each other at high concentrations, changing their absorption properties, (2) solute-solute interactions alter the local environment, (3) refractive index changes significantly, and (4) the solution may become saturated. This is called "positive deviation" from Beer's Law.</p>
            </div>

            <div class="info-box">
                <div class="info-box-title">Q5: Yellow Solution</div>
                <p class="answer-key-value">a) Blue or violet construction paper (complementary color to yellow)</p>
                <p class="answer-key-value">b) Blue channel</p>
                <p class="answer-key-value">c) Yellow solutions absorb blue/violet light. Using blue paper as the background provides blue light that will be absorbed by the yellow solution. The blue channel reading will decrease as yellow solution concentration increases, giving us the greatest dynamic range for measurement.</p>
            </div>

            <div class="info-box">
                <div class="info-box-title">Q6: Negative Absorbance</div>
                <p class="answer-key-value">Negative absorbance means \(I > I_0\) (sample reading higher than blank). Possible causes: (1) blank was measured incorrectly or at a different time when lighting was different, (2) auto-exposure adjusted between measurements, (3) sample cuvette was cleaner than blank cuvette, (4) sample position was different (closer to light source), (5) blank solution was accidentally contaminated. To troubleshoot: re-measure blank and sample immediately after each other, verify exposure is locked, check cuvette cleanliness, mark exact sample position.</p>
            </div>

            <div class="info-box">
                <div class="info-box-title">DILUTION VERIFICATION ANSWERS</div>
                <p class="answer-key-value">\(C_1 = 100\%\), \(V_1 = 4\) mL, \(C_2 = 40\%\), \(V_2 = 10\) mL</p>
                <p class="answer-key-value">Verification: \(100 \times 4 = 40 \times 10 = 400\)</p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let calibrationChart = null;
        const dataPoints = [];
        let savedData = {};

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeTabs();
            initializeChart();
            loadSavedData();
            setupAutoSave();
            updateTime();
            setInterval(updateTime, 1000);
            generateSessionId();

            // Initialize KaTeX auto-render for mathematical formulas (with delay for deferred scripts)
            setTimeout(renderMath, 100);
        });

        // Render KaTeX math formulas
        function renderMath() {
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '\\[', right: '\\]', display: true},
                        {left: '\\(', right: '\\)', display: false},
                        {left: '$', right: '$', display: false}
                    ],
                    throwOnError: false,
                    ignoredTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'input']
                });
            } else {
                // Retry if KaTeX hasn't loaded yet
                setTimeout(renderMath, 100);
            }
        }

        // Session ID
        function generateSessionId() {
            const id = 'LAB-' + Date.now().toString(36).toUpperCase();
            document.getElementById('session-id').textContent = id;
        }

        // Time display
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleTimeString();
        }

        // Tab Navigation
        function initializeTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.dataset.tab;

                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));

                    btn.classList.add('active');
                    document.getElementById(tabId).classList.add('active');

                    // Update summary when going to submit tab
                    if (tabId === 'submit') {
                        updateSummary();
                    }
                });
            });
        }

        // Chart initialization
        function initializeChart() {
            const ctx = document.getElementById('calibration-chart').getContext('2d');
            calibrationChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Standards',
                        data: [],
                        backgroundColor: '#667eea',
                        borderColor: '#5b21b6',
                        pointRadius: 10,
                        pointStyle: 'circle',
                        borderWidth: 2
                    }, {
                        label: 'Best Fit Line',
                        data: [],
                        type: 'line',
                        borderColor: '#764ba2',
                        borderWidth: 3,
                        pointRadius: 0,
                        fill: false
                    }, {
                        label: 'Unknown',
                        data: [],
                        backgroundColor: '#f59e0b',
                        borderColor: '#d97706',
                        pointRadius: 12,
                        pointStyle: 'triangle',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Concentration (%)',
                                font: { family: 'IBM Plex Mono', size: 14, weight: 'bold' },
                                color: '#5b21b6'
                            },
                            min: 0,
                            max: 110,
                            grid: { color: '#e2e8f0' },
                            ticks: { color: '#64748b' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Absorbance (A)',
                                font: { family: 'KaTeX_Main, IBM Plex Mono', size: 14, weight: 'bold' },
                                color: '#5b21b6'
                            },
                            min: 0,
                            max: 0.8,
                            grid: { color: '#e2e8f0' },
                            ticks: { color: '#64748b' }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                font: { family: 'IBM Plex Mono' },
                                color: '#475569'
                            }
                        }
                    }
                }
            });
        }

        // Data calculation and chart update
        function calculateAndUpdate() {
            const i0 = parseFloat(document.getElementById('blank-intensity').value);
            if (!i0 || i0 <= 0) return;

            const concentrations = [20, 40, 60, 80, 100];
            const standardData = [];

            concentrations.forEach(conc => {
                const r1 = document.querySelector(`.reading1[data-conc="${conc}"]`);
                const r2 = document.querySelector(`.reading2[data-conc="${conc}"]`);
                const avgCell = document.querySelector(`.avg-cell[data-conc="${conc}"]`);
                const tCell = document.querySelector(`.t-cell[data-conc="${conc}"]`);
                const aCell = document.querySelector(`.a-cell[data-conc="${conc}"]`);

                const v1 = parseFloat(r1.value);
                const v2 = parseFloat(r2.value);

                if (v1 && v2) {
                    const avg = (v1 + v2) / 2;
                    const t = avg / i0;
                    const a = t > 0 ? -Math.log10(t) : 0;

                    avgCell.textContent = avg.toFixed(1);
                    tCell.textContent = t.toFixed(3);
                    aCell.textContent = a.toFixed(3);

                    if (a > 0) {
                        standardData.push({ x: conc, y: a });
                    }
                } else {
                    avgCell.textContent = '--';
                    tCell.textContent = '--';
                    aCell.textContent = '--';
                }
            });

            // Calculate unknown
            const uR1 = document.querySelector('.reading1[data-conc="unknown"]');
            const uR2 = document.querySelector('.reading2[data-conc="unknown"]');
            const uAvgCell = document.querySelector('.avg-cell[data-conc="unknown"]');
            const uTCell = document.querySelector('.t-cell[data-conc="unknown"]');
            const uACell = document.querySelector('.a-cell[data-conc="unknown"]');

            let unknownA = null;
            const uV1 = parseFloat(uR1.value);
            const uV2 = parseFloat(uR2.value);

            if (uV1 && uV2) {
                const uAvg = (uV1 + uV2) / 2;
                const uT = uAvg / i0;
                unknownA = uT > 0 ? -Math.log10(uT) : 0;

                uAvgCell.textContent = uAvg.toFixed(1);
                uTCell.textContent = uT.toFixed(3);
                uACell.textContent = unknownA.toFixed(3);
            } else {
                uAvgCell.textContent = '--';
                uTCell.textContent = '--';
                uACell.textContent = '--';
            }

            // Update chart
            updateChart(standardData, unknownA);
        }

        function updateChart(standardData, unknownA) {
            calibrationChart.data.datasets[0].data = standardData;

            if (standardData.length >= 2) {
                // Calculate linear regression
                const { slope, intercept, r2 } = linearRegression(standardData);

                // Update stats display
                document.getElementById('slope-value').textContent = slope.toFixed(5);
                document.getElementById('intercept-value').textContent = intercept.toFixed(4);
                document.getElementById('r2-value').textContent = r2.toFixed(4);
                document.getElementById('eq-slope').textContent = slope.toFixed(5);
                document.getElementById('eq-intercept').textContent = intercept.toFixed(4);

                // Draw best fit line
                calibrationChart.data.datasets[1].data = [
                    { x: 0, y: intercept },
                    { x: 110, y: slope * 110 + intercept }
                ];

                // Calculate unknown concentration
                if (unknownA !== null && unknownA > 0) {
                    const unknownConc = (unknownA - intercept) / slope;
                    document.getElementById('unknown-a-display').textContent = unknownA.toFixed(3);
                    document.getElementById('calculated-unknown').textContent = unknownConc.toFixed(1);
                    calibrationChart.data.datasets[2].data = [{ x: unknownConc, y: unknownA }];
                } else {
                    document.getElementById('unknown-a-display').textContent = '--';
                    document.getElementById('calculated-unknown').textContent = '--';
                    calibrationChart.data.datasets[2].data = [];
                }
            } else {
                document.getElementById('slope-value').textContent = '--';
                document.getElementById('intercept-value').textContent = '--';
                document.getElementById('r2-value').textContent = '--';
                document.getElementById('eq-slope').textContent = 'm';
                document.getElementById('eq-intercept').textContent = 'b';
                calibrationChart.data.datasets[1].data = [];
                calibrationChart.data.datasets[2].data = [];
            }

            calibrationChart.update();
        }

        // Linear regression calculation
        function linearRegression(data) {
            const n = data.length;
            let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0, sumY2 = 0;

            data.forEach(point => {
                sumX += point.x;
                sumY += point.y;
                sumXY += point.x * point.y;
                sumX2 += point.x * point.x;
                sumY2 += point.y * point.y;
            });

            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;

            // R-squared
            const meanY = sumY / n;
            let ssTot = 0, ssRes = 0;
            data.forEach(point => {
                ssTot += (point.y - meanY) ** 2;
                ssRes += (point.y - (slope * point.x + intercept)) ** 2;
            });
            const r2 = 1 - (ssRes / ssTot);

            return { slope, intercept, r2 };
        }

        // Setup auto-save and input listeners
        function setupAutoSave() {
            // All inputs and textareas
            document.querySelectorAll('input, textarea').forEach(el => {
                el.addEventListener('input', () => {
                    saveData();
                    calculateAndUpdate();
                });
            });

            // Specific listener for blank intensity
            document.getElementById('blank-intensity').addEventListener('input', calculateAndUpdate);
        }

        // Save data to localStorage
        function saveData() {
            const data = {};
            document.querySelectorAll('input, textarea').forEach(el => {
                if (el.id || el.dataset.conc) {
                    const key = el.id || `${el.className}-${el.dataset.conc}`;
                    data[key] = el.value;
                }
            });

            // Save checklist state
            document.querySelectorAll('.checklist-item').forEach((item, idx) => {
                data[`checklist-${idx}`] = item.classList.contains('checked');
            });

            localStorage.setItem('colorimetry-lab-data', JSON.stringify(data));
            showSaveStatus('[SAVED]');
        }

        // Load saved data
        function loadSavedData() {
            const saved = localStorage.getItem('colorimetry-lab-data');
            if (saved) {
                const data = JSON.parse(saved);

                document.querySelectorAll('input, textarea').forEach(el => {
                    if (el.id || el.dataset.conc) {
                        const key = el.id || `${el.className}-${el.dataset.conc}`;
                        if (data[key]) {
                            el.value = data[key];
                        }
                    }
                });

                // Restore checklist state
                document.querySelectorAll('.checklist-item').forEach((item, idx) => {
                    if (data[`checklist-${idx}`]) {
                        item.classList.add('checked');
                        item.querySelector('.checklist-box').textContent = 'X';
                    }
                });

                calculateAndUpdate();
                showSaveStatus('[LOADED]');
            }
        }

        // Show save status
        function showSaveStatus(status) {
            const statusEl = document.getElementById('save-status');
            statusEl.textContent = status;
            setTimeout(() => {
                statusEl.textContent = '[OK]';
            }, 1500);
        }

        // Checklist toggle
        function toggleCheck(item) {
            item.classList.toggle('checked');
            const box = item.querySelector('.checklist-box');
            box.textContent = item.classList.contains('checked') ? 'X' : '';
            saveData();
        }

        // Update summary
        function updateSummary() {
            document.getElementById('summary-name').textContent = document.getElementById('student-name').value || '--';
            document.getElementById('summary-date').textContent = document.getElementById('lab-date').value || '--';
            document.getElementById('summary-section').textContent = document.getElementById('section').value || '--';
            document.getElementById('summary-i0').textContent = document.getElementById('blank-intensity').value || '--';
            document.getElementById('summary-r2').textContent = document.getElementById('r2-value').textContent;
            document.getElementById('summary-unknown').textContent = document.getElementById('final-unknown').value || document.getElementById('calculated-unknown').textContent;
        }

        // Download PDF
        function downloadPDF() {
            showSaveStatus('[GENERATING PDF...]');

            const element = document.querySelector('.container');
            const studentName = document.getElementById('student-name').value || 'Student';
            const date = document.getElementById('lab-date').value || new Date().toLocaleDateString();

            const opt = {
                margin: 10,
                filename: `DIY_Colorimetry_Lab_${studentName.replace(/\s+/g, '_')}_${date.replace(/\//g, '-')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // Temporarily show all tabs for PDF
            const contents = document.querySelectorAll('.tab-content');
            const instructorTabs = document.querySelectorAll('.instructor-only');

            contents.forEach(c => c.style.display = 'block');
            instructorTabs.forEach(t => t.style.display = 'none'); // Hide instructor sections

            html2pdf().set(opt).from(element).save().then(() => {
                // Restore tab visibility
                contents.forEach(c => c.style.display = '');
                document.querySelector('.tab-content.active').style.display = 'block';
                showSaveStatus('[PDF DOWNLOADED]');
            });
        }

        // Print
        function printLab() {
            window.print();
        }

        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                localStorage.removeItem('colorimetry-lab-data');
                document.querySelectorAll('input, textarea').forEach(el => {
                    el.value = '';
                });
                document.querySelectorAll('.checklist-item').forEach(item => {
                    item.classList.remove('checked');
                    item.querySelector('.checklist-box').textContent = '';
                });
                calculateAndUpdate();
                showSaveStatus('[CLEARED]');
            }
        }
    </script>
</body>
</html>